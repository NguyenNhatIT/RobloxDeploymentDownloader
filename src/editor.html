<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roblox LuaU Editor</title>
<style>
html, body {
  height: 100%;
  margin: 0;
  background-color: #0E111B;
  overflow: hidden;
}
#container {
  width: 100%;
  height: 100%;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js"></script>
<script>
require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs' } });

require(['vs/editor/editor.main'], function () {

  // --- Theme RobloxDark ---
  monaco.editor.defineTheme('robloxDark', {
    base: 'vs-dark',
    inherit: true,
    rules: [
      { token: '', background: '0E111B' },
      { token: 'keyword', foreground: 'C586C0' },
      { token: 'identifier', foreground: '9CDCFE' },
      { token: 'number', foreground: 'B5CEA8' },
      { token: 'string', foreground: 'CE9178' },
      { token: 'comment', foreground: '6A9955', fontStyle: 'italic' },
      { token: 'operator', foreground: 'D4D4D4' },
      { token: 'roblox.class', foreground: '4FC3F7', fontStyle: 'bold' },
      { token: 'roblox.property', foreground: 'E5C07B' },
      { token: 'roblox.method', foreground: '56B6C2' },
    ],
    colors: {
      'editor.background': '#0E111B',
      'editorLineNumber.foreground': '#3E4451',
      'editorCursor.foreground': '#FFFFFF',
      'editorLineNumber.activeForeground': '#9CDCFE',
      'editor.selectionBackground': '#264F78',
      'editor.inactiveSelectionBackground': '#3A3D41',
      'minimap.background': '#0E111B',
    }
  });

  // --- Register LuaU Syntax ---
  monaco.languages.register({ id: 'luau' });
  monaco.languages.setMonarchTokensProvider('luau', {
    tokenizer: {
      root: [
        [/\b(local|if|then|end|for|while|function|return|break|and|or|not|in)\b/, 'keyword'],
        [/\b(game|workspace|Instance|Vector3|BrickColor|Color3|CFrame)\b/, 'roblox.class'],
        [/\b(Parent|Position|Color|Anchored|Size|Material|Transparency|CanCollide)\b/, 'roblox.property'],
        [/\b(new|FindFirstChild|WaitForChild|Connect)\b/, 'roblox.method'],
        [/"([^"\\]|\\.)*$/, 'string.invalid'],
        [/"([^"\\]|\\.)*"/, 'string'],
        [/'([^'\\]|\\.)*'/, 'string'],
        [/[0-9]+(\.[0-9]+)?/, 'number'],
        [/[a-zA-Z_]\w*/, 'identifier'],
        [/--.*/, 'comment']
      ]
    }
  });

  // --- Completion Provider (Auto Suggest) ---
  monaco.languages.registerCompletionItemProvider('luau', {
    provideCompletionItems: function (model, position) {
      const word = model.getWordUntilPosition(position);
      const range = {
        startLineNumber: position.lineNumber,
        endLineNumber: position.lineNumber,
        startColumn: word.startColumn,
        endColumn: word.endColumn
      };

      const suggestions = [
        { label: 'print', kind: monaco.languages.CompletionItemKind.Function, insertText: 'print(${1:msg})', insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet },
        { label: 'Instance.new', kind: monaco.languages.CompletionItemKind.Function, insertText: 'Instance.new("${1:Part}")', insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet },
        { label: 'Vector3.new', kind: monaco.languages.CompletionItemKind.Function, insertText: 'Vector3.new(${1:0}, ${2:0}, ${3:0})', insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet },
        { label: 'Color3.fromRGB', kind: monaco.languages.CompletionItemKind.Function, insertText: 'Color3.fromRGB(${1:255}, ${2:255}, ${3:255})', insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet },
        { label: 'BrickColor.new', kind: monaco.languages.CompletionItemKind.Function, insertText: 'BrickColor.new("${1:Bright blue}")', insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet },
        { label: 'workspace', kind: monaco.languages.CompletionItemKind.Variable, insertText: 'workspace' },
        { label: 'game', kind: monaco.languages.CompletionItemKind.Variable, insertText: 'game' },
        { label: 'Parent', kind: monaco.languages.CompletionItemKind.Property, insertText: 'Parent' },
        { label: 'Position', kind: monaco.languages.CompletionItemKind.Property, insertText: 'Position' },
        { label: 'Anchored', kind: monaco.languages.CompletionItemKind.Property, insertText: 'Anchored' },
        { label: 'Size', kind: monaco.languages.CompletionItemKind.Property, insertText: 'Size' }
      ];

      return { suggestions: suggestions.map(s => ({ ...s, range })) };
    }
  });

  // --- Create Editor ---
  const editor = monaco.editor.create(document.getElementById('container'), {
    value: '-- Made by Nguyễn Minh Nhật\nprint("Hello Roblox!")\n\nlocal part = Instance.new("Part")\npart.Parent = workspace\npart.BrickColor = BrickColor.new("Bright blue")\npart.Anchored = true\npart.Position = Vector3.new(0, 10, 0)',
    language: 'luau',
    theme: 'robloxDark',
    fontSize: 15,
    fontFamily: 'Consolas, monospace',
    automaticLayout: true,
    smoothScrolling: true,
    roundedSelection: true,
    minimap: { enabled: true },
  });

  // --- Re-trigger suggestion on every input ---
  editor.onDidChangeModelContent(() => {
    editor.trigger('any', 'editor.action.triggerSuggest', {});
  });

  // --- Expose functions for WPF ---
  window.getText = function () {
    return editor.getValue();
  };
  window.setText = function (text) {
    editor.setValue(text || "");
  };
  window.clearText = function () {
    editor.setValue("");
  };

  // --- Optional: expose ready flag ---
  window.editorReady = true;
});
</script>
</head>
<body>
<div id="container"></div>
</body>
</html>
